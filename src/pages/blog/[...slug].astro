---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import CTA from '../../components/CTA.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => !data.draft);
  return posts.map((post) => ({
    params: { slug: post.id.replace(/\.mdx?$/, '') },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const { title, description, publishDate, category, tags } = post.data;

const formattedDate = publishDate.toLocaleDateString('en-IE', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout
  title={`${title} â€” Fivesco`}
  description={description}
  type="article"
  publishDate={publishDate}
>
  <article class="py-20">
    <div class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8">
      <!-- Header -->
      <div class="mb-12">
        <a href="/blog" class="text-sm font-medium text-primary-600 hover:text-primary-800 transition-colors">&larr; All Posts</a>
        <div class="mt-4 flex items-center gap-3">
          <span class="rounded-full bg-primary-50 px-3 py-1 text-xs font-semibold text-primary-700">{category}</span>
          <time class="text-sm text-gray-500">{formattedDate}</time>
        </div>
        <h1 class="mt-4 text-3xl font-bold text-navy-900 sm:text-4xl">{title}</h1>
        <p class="mt-4 text-lg text-gray-600">{description}</p>
      </div>

      <!-- Content -->
      <div class="prose">
        <Content />
      </div>

      <!-- Tags -->
      {tags.length > 0 && (
        <div class="mt-12 border-t border-gray-200 pt-8">
          <div class="flex flex-wrap gap-2">
            {tags.map((tag) => (
              <span class="rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-600">{tag}</span>
            ))}
          </div>
        </div>
      )}
    </div>
  </article>

  <CTA title="Need a website that performs?" description="Get in touch to discuss your project and see how we can help." />
</BaseLayout>
